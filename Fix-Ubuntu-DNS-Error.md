---
title: Ubuntu下apt “无法解析域名”解决方案
author: Gaein nidb
tags:
  - 运维
  - Linux
  - DNS
  - 服务器
categories: 服务器运维
date: 2018-10-20 11:42:39
---

> 注意，本博客过于久远，内容可能已经不适用

DNS莫名其妙出错，啥也干不了

![错误](https://img.cdn.gaein.cn/website_used/blog/Fix-Ubuntu-DNS-Error/01.webp)

百度了一波，发现解决方案很简单，就是手动加入DNS

```sh
sudo vim /etc/resolv.conf
```
加入DNS

```
nameserver 119.29.29.29
```

> 当然可以自己去百度其他家的DNS，我这是DNS PUBLIC+的地址

按照百度说的我保存重启

结果发现并没有什么卵用...

仔细观摩一下文件

```
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 127.0.0.53</pre>
```

被覆盖了

而且说明也写着“DO NOT EDIT THIS FILE BY HAND”

我按照其他的方法修改了一下编辑resolv.conf.d目录下的base文件

不过也没有效果

但是按照第二篇看的文章找到了问题所在：

重启系统后DNS设置不但不会被应用还会被覆盖，应该重启网卡来解决

```sh
sudo /etc/init.d/networking restart</pre>
```

完美解决

![修复](https://img.cdn.gaein.cn/website_used/blog/Fix-Ubuntu-DNS-Error/02.webp)

参考：

* [ubuntu apt-get 异常 Temporary failure resolving 'us.archive.ubuntu.com' 解决 - 人工智能](http://www.myexceptions.net/ai/1477082.html)
* [ubuntu16.04 出现域名解析暂时失败 解决方法_tsq292978891的博客-CSDN博客_域名解析暂时失败](https://blog.csdn.net/tsq292978891/article/details/75039926)
* [ubuntu域名解析失败解决方案_廿四桥明月夜的博客-CSDN博客_ubuntu域名解析失败](https://blog.csdn.net/u012207345/article/details/78339218)

不过刚刚重启了好像又被覆盖了，很是绝望

干脆写了个脚本，然后开机自动运行脚本得了...

```sh
#!/bin/bash
  
### BEGIN INIT INFO
# Provides:     run.sh 
# Required-start:    $local_fs $remote_fs $network $syslog 
# Required-Stop:     $local_fs $remote_fs $network $syslog 
# Default-Start:     2 3 4 5 
# Default-Stop:      0 1 6 
# Short-Description: starts the run.shh daemon 
# Description:       starts run.sh using start-stop-daemon 
### END INIT INFO

sudo echo "nameserver 119.29.29.29" >> /etc/resolv.conf
sudo /etc/init.d/networking restart
```

然后复制到init.d中，再

```
update-rc.d run.sh defaults 99
```
